<html>
	<head>
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript">
		
			var fps = 2;
			var now;
			var then = Date.now();
			var interval = 1000/fps;
			var delta;
		
			// http://www.html5canvastutorials.com/advanced/html5-canvas-animation-stage/
			window.requestAnimFrame = (function(callback) {
				return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || window.oRequestAnimationFrame || window.msRequestAnimationFrame ||
				function(callback) {
					window.setTimeout(callback, 1000 / 60
					);
				};
			})();
		
		
			function rad2deg(rad)
			{
				return rad * (180 / Math.PI);
			}

			function deg2rad(deg)
			{
				return deg * (Math.PI / 180);
			}
		
			function calcInclination (from, to)
			{
				return Math.atan((to.y - from.y) / (to.x - from.x));;
			}
			
			function calcBeta(inclination) {
				return deg2rad(90) - inclination;
			}
		
			/**
			* Inclination in rad
			* left array, with left contour
			* right array, with right contour
			*/
			function calcFat(linePoint, width, beta, left, right) {
				var offsetX = Math.sin(beta) * width
				var offsetY = Math.cos(beta) * width

				left.push(point(linePoint.x - offsetX, linePoint.y - offsetX));
				right.push(point(linePoint.x + offsetX, linePoint.y + offsetX));
			}
		
			function lineWidth(t, offset) {
				//return 5 + Math.abs(Math.sin((t + offset) * Math.PI)) * 20;
				return Math.random() * 20
			}
			
			function point(x, y) {
				return {x: x, y: y};
			}

			function calcPoint(from, to, t) {
				return (1 - t) * from + t * to 
			}

			function line(from, to, resolution, offset) {
				var increment = resolution || 0.1;
				var segments = [];
				for(var t=0; t < 1; t+=increment) {
					segments.push({
						point: {
							x: calcPoint(from.x,to.x,t),
							y: calcPoint(from.y,to.y,t)
						},
						lineWidth: lineWidth(t, offset),
					});
				}
				
				return segments;
			}

			function drawLine(ctx, from, to, offset, fillcolor) {
				var segments = line(from, to, .05, offset);
				var inclination = calcInclination(from, to);
				var beta = calcBeta(inclination);
				var left = [];
				var right = [];
				
				for(var i=1; i < segments.length; i++) {
					calcFat(segments[i].point, segments[i].lineWidth, beta, left, right);
				}
				
				ctx.beginPath();
				ctx.moveTo(left[0].x, left[0].y);
				
				for(var i=1;i < left.length; i++) {
					ctx.lineTo(left[i].x, left[i].y);
				}
				
				for(var i=right.length-1;i > -1; i--) {
					ctx.lineTo(right[i].x, right[i].y);
				}
				
				ctx.fillStyle = fillcolor
				ctx.fill();
			}
			
			function drawFrame (offset) {
				now = Date.now();
				delta = now - then;
				
				if (delta > interval) {
					var canvas = document.getElementById("canvas");
					var ctx = canvas.getContext("2d");
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					
					drawLine(ctx, point(500, 0), point(0, 500), offset, 'blue');
					drawLine(ctx, point(500, 0), point(0, 500), offset, 'gold');
					drawLine(ctx, point(500, 0), point(0, 500), offset, 'red');
					drawLine(ctx, point(500, 0), point(0, 500), offset, 'black');
					
					offset += .01;
					then = now - (delta % interval);
				}
				
				requestAnimFrame(function() {
					drawFrame(offset);
				});
			}
			
			$(document).ready(function () {
				drawFrame(0); 
			});
		</script>
	</head>
	<body>
		<canvas id="canvas" width="500" height="500"></canvas>
	</body>
</html>